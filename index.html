<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px 24px 24px;
      background: radial-gradient(circle at top, #1a2550 0, #0b1027 56%, #07081a 100%);
      color: #f5f7ff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    body.export-mode {
      background: #0b1126 !important;
    }
    body.export-mode * {
      background-image: none !important;
    }
    body.export-mode .config-screen {
      background: #0b1126 !important;
    }
    body.export-mode .subtle-divider {
      background: rgba(255,255,255,0.14) !important;
    }
    body.export-mode .overlay {
      background: rgba(0,0,0,0.72) !important;
    }
    body.export-mode .btn,
    body.export-mode .btn-small {
      background: #ffd369 !important;
    }
    body.export-mode .no-cover {
      background: rgba(255,255,255,0.06) !important;
    }

    .config-screen {
      width: 100%;
      max-width: 480px;
      padding: 24px 24px 20px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #2b3362, #070a1f);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.75);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .config-title {
      font-size: 20px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 4px;
    }

    .config-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.85;
      margin-bottom: 4px;
    }

    .config-lang-group {
      display: flex;
      gap: 10px;
    }

    .config-lang-group label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    .config-lang-group input {
      accent-color: #ffd369;
    }

    .config-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 13px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
      flex-shrink: 0;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background-color: #343950;
      transition: .2s;
      border-radius: 999px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: #f5f7ff;
      transition: .2s;
      border-radius: 50%;
    }

    .switch input:checked + .slider {
      background-color: #ffd369;
    }

    .switch input:checked + .slider:before {
      transform: translateX(18px);
    }

    .config-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ffd369, #ffb347);
      color: #141414;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.55);
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.55);
    }

    .app {
      display: none;
      width: 100%;
      max-width: 1600px;
      height: 100vh;
      padding: 16px 24px 24px;
      flex-direction: column;
      gap: 14px;
    }

    .app.visible {
      display: flex;
    }

    .grid-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 12px;
    }

    .subtle-divider {
      height: 1px;
      width: 100%;
      background: linear-gradient(
        to right,
        transparent 0%,
        rgba(255, 255, 255, 0.14) 25%,
        rgba(255, 255, 255, 0.14) 75%,
        transparent 100%
      );
      opacity: 0.85;
    }

    .not-played-label {
      font-size: 11px;
      opacity: 0.8;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      margin-left: 4px;
    }

    .card {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      background: rgba(7, 10, 28, 0.92);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.06);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, border-color 0.12s ease-out;
    }

    .card.ranked {
      border-color: #ffc857;
      box-shadow: 0 0 0 1px rgba(255, 200, 87, 0.45), 0 12px 26px rgba(0, 0, 0, 0.82);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.86);
    }

    .cover {
      position: relative;
      width: 100%;
      aspect-ratio: 3 / 4;
      overflow: hidden;
      background: rgba(5, 8, 22, 0.9);
    }

    .cover img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
      background: rgba(5, 8, 22, 0.9);
    }

    .overlay {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      padding: 7px 8px 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.82) 0%,
        rgba(0, 0, 0, 0.62) 55%,
        transparent 100%
      );
      z-index: 2;
    }

    .rank-chip {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.72);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.45);
      flex-shrink: 0;
    }

    .rank-chip .hash {
      font-size: 13px;
      font-weight: 700;
      color: #ffd369;
    }

    .rank-input {
      width: 28px;
      background: transparent;
      border: none;
      border-bottom: 2px solid rgba(255, 255, 255, 0.25);
      color: #ffdf7b;
      font-size: 15px;
      font-weight: 800;
      padding: 0 0 1px;
      text-align: center;
      outline: none;
      -moz-appearance: textfield;
    }

    .rank-input::-webkit-outer-spin-button,
    .rank-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .rank-input::placeholder {
      color: rgba(255, 255, 255, 0.25);
    }

    .rank-input:focus {
      border-bottom-color: #ffd86b;
    }

    .title {
      flex: 1;
      font-size: 14px;
      font-weight: 750;
      color: #ffffff;
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8);
      line-height: 1.18;
      white-space: normal;
      word-break: break-word;
    }

    .no-cover,
    .spoiler-mask {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(230, 233, 255, 0.85);
      text-align: center;
      padding: 0 8px;
      z-index: 1;
    }

    .no-cover {
      background: repeating-linear-gradient(
        -45deg,
        rgba(255, 255, 255, 0.06),
        rgba(255, 255, 255, 0.06) 6px,
        rgba(0, 0, 0, 0.42) 6px,
        rgba(0, 0, 0, 0.42) 12px
      );
    }

    .spoiler-mask {
      background: rgba(5, 6, 14, 0.88);
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .side-menu {
      position: fixed;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 50;
      font-size: 11px;
      display: none;
    }

    .side-handle {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      background: #ffd369;
      border: 1px solid #ffe9a5;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.85);
      user-select: none;
      color: #2b2130;
      font-weight: 900;
      font-size: 16px;
    }

    .side-panel {
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(4, 7, 22, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      min-width: 185px;
      display: none;
    }

    .side-menu.open .side-panel {
      display: block;
    }

    .side-caption {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.85;
      margin-bottom: 6px;
    }

    .lang-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .lang-select {
      background: #050816;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #f5f7ff;
      padding: 2px 8px;
      font-size: 11px;
      outline: none;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin: 4px 0 8px;
      font-size: 12px;
    }

    .btn-small {
      margin-top: 4px;
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ffd369, #ffb347);
      color: #141414;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.65);
      width: 100%;
    }

    body.spoiler-on .cover img {
      display: none;
    }

    body.spoiler-on .spoiler-mask {
      display: none;
    }

    body.spoiler-on .overlay {
      top: 0;
      bottom: 0;
      padding: 12px 10px;
      display: grid;
      grid-template-rows: auto 1fr;
      align-items: start;
      justify-items: center;
      background: radial-gradient(circle at top, rgba(16, 22, 55, 0.92), rgba(5, 7, 18, 0.92));
      text-align: center;
      gap: 10px;
    }

    body.spoiler-on .rank-chip {
      justify-self: start;
    }

    body.spoiler-on .title {
      align-self: center;
      font-size: 15px;
      text-align: center;
      padding: 0 6px;
      line-height: 1.2;
    }

    @media (max-width: 1500px) {
      .grid { grid-template-columns: repeat(6, 1fr); }
    }
    @media (max-width: 1280px) {
      body { overflow-y: auto; }
      .grid { grid-template-columns: repeat(4, 1fr); }
    }
  </style>
</head>
<body>

  <div id="config-screen" class="config-screen">
    <div class="config-title" data-i18n="configTitle">Configure your view</div>

    <div>
      <div class="config-section-title" data-i18n="langTitle">Language</div>
      <div class="config-lang-group">
        <label>
          <input type="radio" name="lang" value="en" checked />
          <span>English</span>
        </label>
        <label>
          <input type="radio" name="lang" value="fr" />
          <span>Français</span>
        </label>
      </div>
    </div>

    <div>
      <div class="config-section-title" data-i18n="spoilerTitle">Anti-spoiler</div>
      <div class="config-toggle">
        <span data-i18n="spoilerDesc">Hide covers (anti-spoiler)</span>
        <label class="switch">
          <input type="checkbox" id="cfg-spoiler">
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <div class="config-actions">
      <button id="cfg-ok" class="btn" data-i18n="ok">OK</button>
    </div>
  </div>

  <div id="app" class="app">
    <div class="grid-wrapper">
      <div id="grid-ranked" class="grid"></div>

      <div class="subtle-divider"></div>
      <div id="not-played-label" class="not-played-label">UNRANKED :</div>
      <div id="grid-unranked" class="grid"></div>
    </div>
  </div>

  <div id="side-menu" class="side-menu">
    <div id="side-handle" class="side-handle">☰</div>
    <div class="side-panel">
      <div class="side-caption" data-i18n="sideOptions">OPTIONS</div>

      <div class="lang-row">
        <span data-i18n="sideLang">Language</span>
        <select id="side-lang" class="lang-select">
          <option value="en">EN</option>
          <option value="fr">FR</option>
        </select>
      </div>

      <div class="toggle-row">
        <span data-i18n="sideSpoiler">Anti-spoiler</span>
        <label class="switch" style="transform:scale(0.8);transform-origin:right center;">
          <input type="checkbox" id="side-spoiler">
          <span class="slider"></span>
        </label>
      </div>
      <button id="btn-export" class="btn-small" data-i18n="exportImage">Export PNG</button>
    </div>
  </div>

  <script>
    const texts = {
      en: {
        configTitle: "Configure your view",
        langTitle: "Language",
        spoilerTitle: "Anti-spoiler",
        spoilerDesc: "Hide covers (anti-spoiler)",
        ok: "OK",
        notPlayed: "UNRANKED :",
        spoilerMask: "SPOILER",
        sideOptions: "OPTIONS",
        sideLang: "Language",
        sideSpoiler: "Anti-spoiler",
        exportImage: "Export PNG"
      },
      fr: {
        configTitle: "Configurer l'affichage",
        langTitle: "Langue",
        spoilerTitle: "Anti-spoiler",
        spoilerDesc: "Masquer les jaquettes (anti-spoiler)",
        ok: "OK",
        notPlayed: "NON CLASSÉ(S) :",
        spoilerMask: "SPOILER",
        sideOptions: "OPTIONS",
        sideLang: "Langue",
        sideSpoiler: "Anti-spoiler",
        exportImage: "Exporter en PNG"
      }
    };

    const games = [
      {
        id: "sky-1st",
        name: "Trails in the Sky 1st Chapter",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/1/1c/Trails_in_the_Sky_artwork.jpg/250px-Trails_in_the_Sky_artwork.jpg",
        rank: 1
      },
      {
        id: "sky-sc",
        name: "Trails in the Sky SC",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/0/08/Trails_in_the_Sky_SC_artwork.jpg/250px-Trails_in_the_Sky_SC_artwork.jpg",
        rank: 2
      },
      {
        id: "sky-fc",
        name: "Trails in the Sky FC",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/1/1c/Trails_in_the_Sky_artwork.jpg/250px-Trails_in_the_Sky_artwork.jpg"
      },
      {
        id: "sky-3rd",
        name: "Trails in the Sky the 3rd",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/f/f6/Trails_in_the_Sky_the_3rd_artwork.jpg/250px-Trails_in_the_Sky_the_3rd_artwork.jpg"
      },
      {
        id: "zero",
        name: "Trails from Zero",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/c/c7/Trails_from_Zero.jpg/250px-Trails_from_Zero.jpg"
      },
      {
        id: "azure",
        name: "Trails to Azure",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/a/a9/Trails_to_Azure_Steam_artwork.jpg/250px-Trails_to_Azure_Steam_artwork.jpg"
      },
      {
        id: "cs1",
        name: "Trails of Cold Steel",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/a/a7/Trails_of_Cold_Steel_Steam_artwork.jpg/250px-Trails_of_Cold_Steel_Steam_artwork.jpg"
      },
      {
        id: "cs2",
        name: "Trails of Cold Steel 2",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/8/81/Trails_of_Cold_Steel_II_Steam_artwork.jpg/250px-Trails_of_Cold_Steel_II_Steam_artwork.jpg"
      },
      {
        id: "cs3",
        name: "Trails of Cold Steel 3",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/1/15/Trails_of_Cold_Steel_III_Steam_artwork.jpg/250px-Trails_of_Cold_Steel_III_Steam_artwork.jpg"
      },
      {
        id: "cs4",
        name: "Trails of Cold Steel 4",
        cover: "https://upload.wikimedia.org/wikipedia/en/c/cd/Trails_of_Cold_Steel_IV_Cover_Art.png"
      },
      {
        id: "reverie",
        name: "Trails into Reverie",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/1/13/Trails_into_Reverie_Cover_Art.jpg/250px-Trails_into_Reverie_Cover_Art.jpg"
      },
      {
        id: "daybreak",
        name: "Trails through Daybreak",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/e/eb/Trails_through_Daybreak_artwork.jpg/250px-Trails_through_Daybreak_artwork.jpg"
      },
      {
        id: "daybreak2",
        name: "Trails through Daybreak 2",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/0/07/Trails_through_Daybreak_II_artwork.jpg/250px-Trails_through_Daybreak_II_artwork.jpg"
      },
      {
        id: "beyond",
        name: "Trails beyond the Horizon",
        cover: "https://upload.wikimedia.org/wikipedia/en/thumb/4/4a/Trails_Beyond_the_Horizon_artwork.jpg/250px-Trails_Beyond_the_Horizon_artwork.jpg"
      }
    ];

    const rankedGrid = document.getElementById("grid-ranked");
    const unrankedGrid = document.getElementById("grid-unranked");

    let currentLang = "en";
    let spoilerOn = false;

    function applyLanguage() {
      const t = texts[currentLang];
      document.documentElement.lang = currentLang;
      document.getElementById("not-played-label").textContent = t.notPlayed;

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (t[key]) el.textContent = t[key];
      });

      document.querySelectorAll(".spoiler-mask").forEach(el => {
        el.textContent = t.spoilerMask;
      });
    }

    function updateSpoilerState() {
      document.body.classList.toggle("spoiler-on", spoilerOn);
      document.getElementById("side-spoiler").checked = spoilerOn;
      document.getElementById("cfg-spoiler").checked = spoilerOn;
    }

    function createCard(game, index) {
      const card = document.createElement("div");
      card.className = "card";
      card.dataset.id = game.id;
      card.dataset.index = index;

      if (game.rank) {
        card.dataset.rank = game.rank;
        card.classList.add("ranked");
      } else {
        card.dataset.rank = "";
      }

      card.innerHTML = `
        <div class="cover">
          <img src="${game.cover}" alt="${game.name} cover" />
          <div class="overlay">
            <div class="rank-chip">
              <span class="hash">#</span>
              <input class="rank-input" type="text" inputmode="numeric" maxlength="2" />
            </div>
            <div class="title">${game.name}</div>
          </div>
          <div class="no-cover">NO COVER</div>
          <div class="spoiler-mask"></div>
        </div>
      `;

      const input = card.querySelector(".rank-input");
      if (game.rank) input.value = game.rank;

      input.addEventListener("input", () => handleRankChange(card, input));
      input.addEventListener("blur", () => handleRankChange(card, input));
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") input.blur();
      });

      const img = card.querySelector("img");
      const noCover = card.querySelector(".no-cover");
      img.addEventListener("error", () => {
        img.style.display = "none";
        noCover.style.display = "flex";
      });

      return card;
    }

    function handleRankChange(card, input) {
      let value = input.value.trim();
      if (value === "") {
        card.dataset.rank = "";
        card.classList.remove("ranked");
        moveToUnranked(card);
        return;
      }

      const rank = parseInt(value, 10);
      if (!Number.isFinite(rank) || rank <= 0) {
        input.value = "";
        card.dataset.rank = "";
        card.classList.remove("ranked");
        moveToUnranked(card);
        return;
      }

      card.dataset.rank = String(rank);
      card.classList.add("ranked");
      moveToRanked(card);
      sortRanked();
    }

    function moveToRanked(card) {
      if (card.parentElement !== rankedGrid) rankedGrid.appendChild(card);
      sortRanked();
    }

    function moveToUnranked(card) {
      if (card.parentElement !== unrankedGrid) unrankedGrid.appendChild(card);
      sortUnranked();
    }

    function sortRanked() {
      const cards = Array.from(rankedGrid.querySelectorAll(".card"));
      cards.sort((a, b) => {
        const ra = parseInt(a.dataset.rank || "0", 10) || 0;
        const rb = parseInt(b.dataset.rank || "0", 10) || 0;
        if (ra !== rb) return ra - rb;
        const ia = parseInt(a.dataset.index || "0", 10);
        const ib = parseInt(b.dataset.index || "0", 10);
        return ia - ib;
      });
      cards.forEach(c => rankedGrid.appendChild(c));
    }

    function sortUnranked() {
      const cards = Array.from(unrankedGrid.querySelectorAll(".card"));
      cards.sort((a, b) => {
        const ia = parseInt(a.dataset.index || "0", 10);
        const ib = parseInt(b.dataset.index || "0", 10);
        return ia - ib;
      });
      cards.forEach(c => unrankedGrid.appendChild(c));
    }

    games.forEach((g, i) => {
      const card = createCard(g, i);
      if (g.rank) rankedGrid.appendChild(card);
      else unrankedGrid.appendChild(card);
    });

    sortRanked();
    sortUnranked();

    const cfgScreen = document.getElementById("config-screen");
    const app = document.getElementById("app");
    const cfgOk = document.getElementById("cfg-ok");
    const sideMenu = document.getElementById("side-menu");
    const sideHandle = document.getElementById("side-handle");
    const sideSpoiler = document.getElementById("side-spoiler");
    const btnExport = document.getElementById("btn-export");
    const sideLang = document.getElementById("side-lang");

    cfgOk.addEventListener("click", () => {
      const langInput = document.querySelector('input[name="lang"]:checked');
      currentLang = langInput ? langInput.value : "en";
      sideLang.value = currentLang;

      spoilerOn = document.getElementById("cfg-spoiler").checked;

      cfgScreen.style.display = "none";
      app.classList.add("visible");
      sideMenu.style.display = "block";

      applyLanguage();
      updateSpoilerState();

      document.body.style.alignItems = "flex-start";
      document.body.style.justifyContent = "center";
    });

    sideHandle.addEventListener("click", () => {
      sideMenu.classList.toggle("open");
    });

    sideSpoiler.addEventListener("change", () => {
      spoilerOn = sideSpoiler.checked;
      updateSpoilerState();
    });

    sideLang.addEventListener("change", () => {
      currentLang = sideLang.value;
      applyLanguage();
    });

    function nextFrame() {
      return new Promise(resolve => requestAnimationFrame(() => resolve()));
    }

    btnExport.addEventListener("click", async () => {
      if (!window.html2canvas) return;

      const target = document.getElementById("app");
      sideMenu.classList.remove("open");
      document.body.classList.add("export-mode");
      await nextFrame();

      try {
        const canvas = await html2canvas(target, {
          useCORS: true,
          backgroundColor: "#0b1126",
          scale: 2,
          onclone: (doc) => {
            doc.body.classList.add("export-mode");
          }
        });

        const link = document.createElement("a");
        link.download = "top-trails.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      } catch (err) {
        console.error("html2canvas error:", err);
      } finally {
        document.body.classList.remove("export-mode");
      }
    });

    applyLanguage();
  </script>
</body>
</html>
